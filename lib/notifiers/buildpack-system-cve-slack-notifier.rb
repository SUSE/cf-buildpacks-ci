# encoding: utf-8
require_relative '../slack-client'

class BuildpackSystemCVESlackNotifier
  def self.notify!(cves, contents)
    return if contents[:category] == 'stacks-unrelated' || cves.empty?
    slack_output = "There are *#{cves.length}* new CVEs:\n"

    cves.each do |cve|
      slack_output << "- #{cve['title']}*\n"
    end

    slack_client = SlackClient.new(
      ENV['SLACK_WEBHOOK'],
      ENV['SLACK_CHANNEL_TEST'],
      'dependency-notifier-test'
    )
    slack_client.post_to_slack slack_output
  end
end
